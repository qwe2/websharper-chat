(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;$.Define($$,{WebsharperChat:{ChatClient:{Append:function(D){var E;E=a.getElementById("chatbox").appendChild(D.Body).parentNode;b(E).scrollTop(b(E).height());return;},Connect:function(F){return d.SetEventHandlers(new e(F));},Main:function(){var G,H,I;G=d.Connect("ws://"+f.location.host+"/chatsocket");H=i.Input(j.ofArray([i.Text(""),i.Attr().NewAttr("id","message-box"),i.Attr().Class("form-control"),i.Attr().NewAttr("type","text")]));I=function(){return function(K){return K.CharacterCode===13?d.SendText(G,H):null;};};k.Events().OnKeyPress(I,H);return l.add(i.Div(j.ofArray([i.Attr().Class("container")])),j.ofArray([i.Div(j.ofArray([i.Attr().NewAttr("id","chatbox")])),H]));},RenderError:function(L){return i.P(j.ofArray([i.Text(L),i.Attr().Class("bg-danger")]));},RenderMsg:function(M){var N;N=j.ofArray([i.Text(M.Username+": ")]);return l.add(i.P(j.ofArray([i.Tags().NewTag("strong",N)])),j.ofArray([i.Text(M.Msg),i.Attr().Class("bg-info")]));},SendText:function(O,P){var Q;Q=m.Trim(P.get_Value());if(Q!==""){O.send(Q);}return P.set_Value("");},SetEventHandlers:function(R){R.onmessage=function(S){return d.Append(d.RenderMsg(n.parse(o(S.data))));};R.onerror=function(){return d.Append(d.RenderError("Something went wrong."));};return R;}},ClAuth:{LoginForm:function(U){var V,W,X,Y,Z,_0,_1,_4;V=q.Input("");W=r.Validator().IsNotEmpty("Enter Username",V);X=s.WithTextLabel("Username",W);Y=q.Password("");Z=r.Validator().IsNotEmpty("Enter Password",Y);_0=s.WithTextLabel("Password",Z);_1=r.$(r.$(t.Return(function(_2){return function(_3){return[_2,_3];};}),X),_0);_4=t.Do();return s.WithFormContainer(_4.Delay(function(){var _6,_7,_8;_6=u.get_Default();_7=$.New(u,{Label:{$:1,$0:"Login"},Style:_6.Style,Class:_6.Class});_8=u.get_Default();return _4.Bind(s.WithCustomSubmitAndResetButtons(_7,$.New(u,{Label:{$:1,$0:"Reset"},Style:_8.Style,Class:_8.Class}),_1),$.Tupled(function(_9){var _;_=function(ba){if(ba){f.location=U;return t.Return(null);}else{return v.WarningPanel("Login failed");}};return _4.ReturnFrom(v.WithLoadingPane(w.Async("WebsharperChat:0",[_9[0],_9[1]]),_));}));}));},WarningPanel:function(ba){var bb;bb=t.Do();return bb.Delay(function(){return bb.Bind(t.OfElement(function(){return l.add(i.Div(j.ofArray([i.Attr().Class("warningPanel")])),j.ofArray([i.Text(ba)]));}),function(){return bb.ReturnFrom(t.Never());});});},WithLoadingPane:function(bf,bg){return t.Replace(t.BuildFormlet(function(){var bi,bj;bi=i.Div(j.ofArray([i.Attr().Class("loadingPane")]));bj=y.New();z.Start(z.Delay(function(){return z.Bind(bf,function(bl){bj.event.Trigger($.New(C,{$:0,$0:bl}));return z.Return(null);});}));return[bi,function(){},bj.event];}),bg);}},Controls:{EntryPoint:$.Class({get_Body:function(){return d.Main();}})},LoginControl:$.Class({get_Body:function(){return v.LoginForm(this.redirectUrl);}})}});$.OnInit(function(){a=$.Safe($$.document);b=$.Safe($$.jQuery);c=$.Safe($$.WebsharperChat);d=$.Safe(c.ChatClient);e=$.Safe($$.WebSocket);f=$.Safe($$.window);g=$.Safe($$.IntelliFactory.WebSharper);h=$.Safe(g.Html);i=$.Safe(h.Default);j=$.Safe(g.List);k=$.Safe(h.EventsPervasives);l=$.Safe(h.Operators);m=$.Safe(g.Strings);n=$.Safe($$.JSON);o=$.Safe($$.String);p=$.Safe(g.Formlet);q=$.Safe(p.Controls);r=$.Safe(p.Data);s=$.Safe(p.Enhance);t=$.Safe(p.Formlet);u=$.Safe(s.FormButtonConfiguration);v=$.Safe(c.ClAuth);w=$.Safe(g.Remoting);x=$.Safe(g.Control);y=$.Safe(x.FSharpEvent);z=$.Safe(g.Concurrency);A=$.Safe($$.IntelliFactory.Formlet);B=$.Safe(A.Base);return C=$.Safe(B.Result);});$.OnLoad(function(){return;});}());

(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;$.Define($$,{WebsharperChat:{ChatClient:{Append:function(D){var E;E=a.getElementById("chatbox").appendChild(D.Body).parentNode;b(E).scrollTop(b(E).height());return;},Connect:function(F){return d.SetEventHandlers(new e(F));},Main:function(){var G,H,I;G=d.Connect("ws://"+f.location.host+"/chatsocket");H=i.Input(j.ofArray([i.Text(""),i.Attr().NewAttr("id","message-box"),i.Attr().Class("form-control"),i.Attr().NewAttr("type","text")]));I=function(){return function(K){return K.CharacterCode===13?d.SendText(G,H):null;};};k.Events().OnKeyPress(I,H);return l.add(i.Div(j.ofArray([i.Attr().Class("container")])),j.ofArray([i.Div(j.ofArray([i.Attr().NewAttr("id","chatbox")])),H]));},RenderError:function(L){return i.P(j.ofArray([i.Text(L),i.Attr().Class("bg-danger")]));},RenderMsg:function(M){var N,O;if(M.$==0){N=M.$1;O=j.ofArray([i.Text(M.$0+": ")]);return l.add(i.P(j.ofArray([i.Tags().NewTag("strong",O)])),j.ofArray([i.Text(N),i.Attr().Class("bg-info")]));}else{return i.P(j.ofArray([i.Text(M.$0),i.Attr().Class("bg-danger")]));}},SendText:function(P,Q){var R;R=m.Trim(Q.get_Value());if(R!==""){P.send(R);}return Q.set_Value("");},SetEventHandlers:function(S){S.onmessage=function(T){return d.Append(d.RenderMsg(n.parse(o(T.data))));};S.onerror=function(){return d.Append(d.RenderError("Something went wrong."));};return S;}},ClAuth:{LoginForm:function(V){var W,X,Y,Z,_0,_1,_2,_3,_4,_7;W=q.Input("");X=r.Validator().IsNotEmpty("Enter Username",W);Y=s.WithTextLabel("Username",X);Z=s.WithCssClass("form-control",Y);_0=q.Password("");_1=r.Validator().IsNotEmpty("Enter Password",_0);_2=s.WithTextLabel("Password",_1);_3=s.WithCssClass("form-control",_2);_4=r.$(r.$(t.Return(function(_5){return function(_6){return[_5,_6];};}),Z),_3);_7=t.Do();return s.WithFormContainer(_7.Delay(function(){var _9,_,ba,bb,bc;_9=u.get_Default();_={$:1,$0:"btn btn-primary"};ba=$.New(u,{Label:{$:1,$0:"Login"},Style:_9.Style,Class:_});bb=u.get_Default();bc={$:1,$0:"btn btn-default"};return _7.Bind(s.WithCustomSubmitAndResetButtons(ba,$.New(u,{Label:{$:1,$0:"Reset"},Style:bb.Style,Class:bc}),_4),$.Tupled(function(bd){var be;be=function(bf){if(bf){f.location=V;return t.Return(null);}else{return v.WarningPanel("Login failed");}};return _7.ReturnFrom(v.WithLoadingPane(w.Async("WebsharperChat:0",[bd[0],bd[1]]),be));}));}));},WarningPanel:function(bf){var bg;bg=t.Do();return bg.Delay(function(){return bg.Bind(t.OfElement(function(){return l.add(i.Div(j.ofArray([i.Attr().Class("warningPanel")])),j.ofArray([i.Text(bf)]));}),function(){return bg.ReturnFrom(t.Never());});});},WithLoadingPane:function(bk,bl){return t.Replace(t.BuildFormlet(function(){var bn,bo;bn=i.Div(j.ofArray([i.Attr().Class("loadingPane")]));bo=y.New();z.Start(z.Delay(function(){return z.Bind(bk,function(bq){bo.event.Trigger($.New(C,{$:0,$0:bq}));return z.Return(null);});}));return[bn,function(){},bo.event];}),bl);}},Controls:{EntryPoint:$.Class({get_Body:function(){return d.Main();}})},LoginControl:$.Class({get_Body:function(){return v.LoginForm(this.redirectUrl);}})}});$.OnInit(function(){a=$.Safe($$.document);b=$.Safe($$.jQuery);c=$.Safe($$.WebsharperChat);d=$.Safe(c.ChatClient);e=$.Safe($$.WebSocket);f=$.Safe($$.window);g=$.Safe($$.IntelliFactory.WebSharper);h=$.Safe(g.Html);i=$.Safe(h.Default);j=$.Safe(g.List);k=$.Safe(h.EventsPervasives);l=$.Safe(h.Operators);m=$.Safe(g.Strings);n=$.Safe($$.JSON);o=$.Safe($$.String);p=$.Safe(g.Formlet);q=$.Safe(p.Controls);r=$.Safe(p.Data);s=$.Safe(p.Enhance);t=$.Safe(p.Formlet);u=$.Safe(s.FormButtonConfiguration);v=$.Safe(c.ClAuth);w=$.Safe(g.Remoting);x=$.Safe(g.Control);y=$.Safe(x.FSharpEvent);z=$.Safe(g.Concurrency);A=$.Safe($$.IntelliFactory.Formlet);B=$.Safe(A.Base);return C=$.Safe(B.Result);});$.OnLoad(function(){return;});}());

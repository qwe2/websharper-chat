(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;$.Define($$,{WebsharperChat:{ChatClient:{Append:function(x){var y;y=a.getElementById("chatbox").appendChild(x.Body).parentNode;b(y).scrollTop(b(y).height());return;},Connect:function(z){return d.SetEventHandlers(new e(z));},Main:function(){var A,B,C;A=d.Connect("ws://"+f.location.host+"/chatsocket");B=i.Input(j.ofArray([i.Text(""),i.Attr().NewAttr("id","message-box"),i.Attr().Class("form-control"),i.Attr().NewAttr("type","text")]));C=function(){return function(E){return E.CharacterCode===13?d.SendText(A,B):null;};};k.Events().OnKeyPress(C,B);return l.add(i.Div(j.ofArray([i.Attr().Class("container")])),j.ofArray([i.Div(j.ofArray([i.Attr().NewAttr("id","chatbox")])),B]));},RenderError:function(F){return i.P(j.ofArray([i.Text(F),i.Attr().Class("bg-danger")]));},RenderMsg:function(G){var H,I;if(G.$==0){H=G.$1;I=j.ofArray([i.Text(G.$0+": ")]);return l.add(i.P(j.ofArray([i.Tags().NewTag("strong",I)])),j.ofArray([i.Text(H),i.Attr().Class("bg-info")]));}else{return i.P(j.ofArray([i.Text(G.$0),i.Attr().Class("bg-danger")]));}},SendText:function(J,K){var L;L=m.Trim(K.get_Value());if(L!==""){J.send(L);}return K.set_Value("");},SetEventHandlers:function(M){M.onmessage=function(N){return d.Append(d.RenderMsg(n.parse(o(N.data))));};M.onerror=function(){return d.Append(d.RenderError("Something went wrong."));};return M;}},ClAuth:{LoginForm:function(P){return q.Render(function(Q){return function(R){return function(S){return r.RenderLoginForm(Q,R,S);};};},q.Run(function(){f.location=P;return P;},r.LoginPiglet()));},LoginPiglet:$.Field(function(){return q.WithSubmit(s.Is(function(U){return U;},"Invalid username or password",t.op_LessMultiplyGreater(t.op_LessMultiplyGreater(q.Return(function(V){return function(W){return u.Call("WebsharperChat:0",[V,W]);};}),s.Is(function(X){return s.NotEmpty(X);},"Enter Username",q.Yield(""))),s.Is(function(Y){return s.NotEmpty(Y);},"Enter password",q.Yield("")))));}),RenderLoginForm:function(Z,_0,_1){var _2,_5,_8,_,ba;_2=v.input("text",function(_3){return _3;},function(_4){return _4;},Z);_2["HtmlProvider@32"].AddClass(_2.Body,"form-control");_5=v.input("text",function(_6){return _6;},function(_7){return _7;},_0);_5["HtmlProvider@32"].AddClass(_5.Body,"form-control");_5["HtmlProvider@32"].SetAttribute(_5.Body,"type","password");_8=v.Submit(_1);_8["HtmlProvider@32"].AddClass(_8.Body,"btn btn-primary");b(a).keypress(function(_9){if(_9.which===13){_9.preventDefault();b(_8.Body).click();return;}else{return null;}});_=j.ofArray([i.Attr().NewAttr("for",_2.get_Id()),i.Attr().Class("col-sm-2 control-label"),i.Text("Username")]);ba=j.ofArray([i.Attr().NewAttr("for",_5.get_Id()),i.Attr().Class("col-sm-2 control-label"),i.Text("Password")]);return l.add(i.Div(j.ofArray([i.Attr().Class("form-horizontal container"),i.Attr().NewAttr("style","margin-top: 2em; width: 50%; min-width: 200px")])),j.ofArray([l.add(i.Div(j.ofArray([i.Attr().Class("form-group")])),j.ofArray([i.Tags().NewTag("label",_),l.add(i.Div(j.ofArray([i.Attr().Class("col-sm-10")])),j.ofArray([_2]))])),l.add(i.Div(j.ofArray([i.Attr().Class("form-group")])),j.ofArray([i.Tags().NewTag("label",ba),l.add(i.Div(j.ofArray([i.Attr().Class("col-sm-10")])),j.ofArray([_5]))])),l.add(i.Div(j.ofArray([i.Attr().Class("form-group")])),j.ofArray([l.add(i.Div(j.ofArray([i.Attr().Class("col-sm-offset-2 col-sm-10")])),j.ofArray([_8]))])),v.ShowErrors(_1,function(bb){return j.map(function(bc){return l.add(i.P(j.ofArray([i.Attr().NewAttr("style","color: red")])),j.ofArray([i.Text(bc)]));},bb);},i.Div($.New(w,{$:0})))]));}},Controls:{EntryPoint:$.Class({get_Body:function(){return d.Main();}})},LoginControl:$.Class({get_Body:function(){return r.LoginForm(this.redirectUrl);}})}});$.OnInit(function(){a=$.Safe($$.document);b=$.Safe($$.jQuery);c=$.Safe($$.WebsharperChat);d=$.Safe(c.ChatClient);e=$.Safe($$.WebSocket);f=$.Safe($$.window);g=$.Safe($$.IntelliFactory.WebSharper);h=$.Safe(g.Html);i=$.Safe(h.Default);j=$.Safe(g.List);k=$.Safe(h.EventsPervasives);l=$.Safe(h.Operators);m=$.Safe(g.Strings);n=$.Safe($$.JSON);o=$.Safe($$.String);p=$.Safe(g.Piglets);q=$.Safe(p.Piglet1);r=$.Safe(c.ClAuth);s=$.Safe(q.Validation);t=$.Safe(p.Pervasives);u=$.Safe(g.Remoting);v=$.Safe(p.Controls);return w=$.Safe(j.T);});$.OnLoad(function(){r.LoginPiglet();return;});}());

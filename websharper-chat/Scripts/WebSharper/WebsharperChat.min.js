(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;$.Define($$,{WebsharperChat:{Auth:{LoginForm:function(D){var E,F,G,H,I,J,K,N;E=c.Input("");F=d.Validator().IsNotEmpty("Enter Username",E);G=e.WithTextLabel("Username",F);H=c.Password("");I=d.Validator().IsNotEmpty("Enter Password",H);J=e.WithTextLabel("Password",I);K=d.$(d.$(f.Return(function(L){return function(M){return[L,M];};}),G),J);N=f.Do();return e.WithFormContainer(N.Delay(function(){var P,Q,R;P=g.get_Default();Q=$.New(g,{Label:{$:1,$0:"Login"},Style:P.Style,Class:P.Class});R=g.get_Default();return N.Bind(e.WithCustomSubmitAndResetButtons(Q,$.New(g,{Label:{$:1,$0:"Reset"},Style:R.Style,Class:R.Class}),K),$.Tupled(function(S){var T;T=function(U){if(U){h.location=D;return f.Return(null);}else{return j.WarningPanel("Login failed");}};return N.ReturnFrom(j.WithLoadingPane(k.Async("WebsharperChat:0",[S[0],S[1]]),T));}));}));},WarningPanel:function(V){var W;W=f.Do();return W.Delay(function(){return W.Bind(f.OfElement(function(){return m.add(n.Div(o.ofArray([n.Attr().Class("warningPanel")])),o.ofArray([n.Text(V)]));}),function(){return W.ReturnFrom(f.Never());});});},WithLoadingPane:function(_0,_1){return f.Replace(f.BuildFormlet(function(){var _3,_4;_3=n.Div(o.ofArray([n.Attr().Class("loadingPane")]));_4=q.New();r.Start(r.Delay(function(){return r.Bind(_0,function(_6){_4.event.Trigger($.New(u,{$:0,$0:_6}));return r.Return(null);});}));return[_3,function(){},_4.event];}),_1);}},ChatClient:{Append:function(_8){var _9;_9=v.getElementById("chatbox").appendChild(_8.Body).parentNode;w(_9).scrollTop(w(_9).height());return;},Connect:function(_){return x.SetEventHandlers(new y(_));},Main:function(){var ba,bb,bc;ba=x.Connect("ws://"+h.location.host+"/chatsocket");bb=n.Input(o.ofArray([n.Text(""),n.Attr().NewAttr("id","message-box"),n.Attr().Class("form-control"),n.Attr().NewAttr("type","text")]));bc=function(){return function(be){return be.CharacterCode===13?x.SendText(ba,bb):null;};};z.Events().OnKeyPress(bc,bb);return m.add(n.Div(o.ofArray([n.Attr().Class("container")])),o.ofArray([n.Div(o.ofArray([n.Attr().NewAttr("id","chatbox")])),bb]));},RenderError:function(be){return n.P(o.ofArray([n.Text(be),n.Attr().Class("bg-danger")]));},RenderMsg:function(bf){var bg;bg=o.ofArray([n.Text(bf.Username+": ")]);return m.add(n.P(o.ofArray([n.Tags().NewTag("strong",bg)])),o.ofArray([n.Text(bf.Msg),n.Attr().Class("bg-info")]));},SendText:function(bh,bi){var bj;bj=A.Trim(bi.get_Value());if(bj!==""){bh.send(bj);}return bi.set_Value("");},SetEventHandlers:function(bk){bk.onmessage=function(bl){return x.Append(x.RenderMsg(B.parse(C(bl.data))));};bk.onerror=function(){return x.Append(x.RenderError("Something went wrong."));};return bk;}},Controls:{EntryPoint:$.Class({get_Body:function(){return x.Main();}})},LoginControl:$.Class({get_Body:function(){return j.LoginForm(this.redirectUrl);}})}});$.OnInit(function(){a=$.Safe($$.IntelliFactory.WebSharper);b=$.Safe(a.Formlet);c=$.Safe(b.Controls);d=$.Safe(b.Data);e=$.Safe(b.Enhance);f=$.Safe(b.Formlet);g=$.Safe(e.FormButtonConfiguration);h=$.Safe($$.window);i=$.Safe($$.WebsharperChat);j=$.Safe(i.Auth);k=$.Safe(a.Remoting);l=$.Safe(a.Html);m=$.Safe(l.Operators);n=$.Safe(l.Default);o=$.Safe(a.List);p=$.Safe(a.Control);q=$.Safe(p.FSharpEvent);r=$.Safe(a.Concurrency);s=$.Safe($$.IntelliFactory.Formlet);t=$.Safe(s.Base);u=$.Safe(t.Result);v=$.Safe($$.document);w=$.Safe($$.jQuery);x=$.Safe(i.ChatClient);y=$.Safe($$.WebSocket);z=$.Safe(l.EventsPervasives);A=$.Safe(a.Strings);B=$.Safe($$.JSON);return C=$.Safe($$.String);});$.OnLoad(function(){return;});}());
